<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
  <title>Document</title>
</head>
<style>
  html {
    height: 100%;
  }
  body {
    margin: 0;
    height: 100%;
  }
</style>
<body onLoad="init()">
  <canvas id="canvas"  style="display:block;background-color: #ccc;margin:0 auto;"></canvas>
</body>
<script>

  var ctx;
  var canvas;
  var rad          =  9;
  var sx           =  10;
  var sy           =  10;
  var balls        = [];
  var WIDTH        = document.body.clientWidth;
  var HEIGHT       = document.body.clientHeight;
  var fps          = 10;
  var G            = 10 * 40; // m -> px
  var frictionX    = 0.9;
  var frictionY    = 0.9;
  var boundBottom  = HEIGHT - rad;
  var boundLeft    = rad;
  var boundRight   = WIDTH  - rad;
  function init() {
    canvas = document.getElementById('canvas');
    canvas.width  = WIDTH;
    canvas.height = HEIGHT;
    ctx           = canvas.getContext('2d');
    canvas.addEventListener('mousedown', mouseDown, false);
    setInterval(drawAll,fps);

  }
  function mouseDown(e) {
    var x = e.offsetX;
    var y = e.offsetY;
    var a = new Ball(x, y);
    balls.push(a);
  }
  function drawAll() {
    ctx.clearRect(0, 0, WIDTH, HEIGHT);
    for (var i = 0, len = balls.length; i < len; i ++) {
      balls[i].draw().move();
    }
  }

  function Ball(x, y, sx) {
    this.run   = true;
    this.x     = x;
    this.y     = y;
    this.sx    = -3;
    this.initY = y;
    this.maxY  = y;
    this.EX    = 0.5 * this.sx * this.sx;
    this.EY    = (boundBottom - this.y) * G;
    this.v0    = 0;
    this.vt    = 0;
    this.g     = G;
    this.rad   = rad;
    this.bornTime = (new Date()).getTime() / 1000;
    this.fillStyle = newColor();
  }

  Ball.prototype = {
    draw : function() {
      ctx.fillStyle = this.fillStyle;
      ctx.beginPath();
      ctx.arc(this.x, this.y, this.rad, 0, Math.PI * 2, true);
      ctx.fill();
      // ctx.font="20px Georgia";
      // ctx.fillText('x: '+ this.x,this.x-150,this.y);
      return this;
    },
    move: function() {
      if (!this.run) {
        return;
      }
      var nowTime = newTime();
      var t       = nowTime - this.bornTime;
      var disY;
      disY    = this.vt * t - G * 0.5 * t * t;
      this.y  = this.maxY - disY;

      this.x += this.sx;
      if (this.x >= boundRight) {
        this.x  = boundRight;
        this.EX = this.EX * frictionX;
        this.sx = - this.getVbyE(this.EX);
      }
      if (this.x <= boundLeft) {
        this.x  = boundLeft;
        this.EX = this.EX * frictionX;
        this.sx = this.getVbyE(this.EX);
      }

      if (this.y > boundBottom) {
        this.bornTime = newTime();
        this.maxY     = boundBottom;
        this.sx = this.sx * 0.999;
        this.EY = this.EY * frictionY;
        this.vt       = this.getVbyE(this.EY);
        this.g        = - this.g;
      }
      this.check();
      return this;
    },
    check: function () {
      if (!this.run) {
        return;
      }
      this.EX    = 0.5 * this.sx * this.sx;
      if (this.EY < 0.1 && this.EX < 0.1) {
        this.run = false;
      }
      return this;
    },
    getVbyE: function(E) {
      return Math.sqrt(E * 2);
    }
  };
  function newTime() {
    return (new Date()).getTime() / 1000;
  }

  function newColor() {
    var r, g, b;
    r = random();
    g = random();
    b = random();
    function random() {
      return Math.floor(Math.random() * (255 - 0)) + 0;
    }
    return 'rgb('+ r +',' + g + ',' + b + ')';
  }
</script>
</html>